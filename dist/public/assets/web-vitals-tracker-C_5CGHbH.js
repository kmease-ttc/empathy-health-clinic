var _=Object.defineProperty;var z=(e,t,r)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var p=(e,t,r)=>z(e,typeof t!="symbol"?t+"":t,r);let W=-1;const g=e=>{addEventListener("pageshow",t=>{t.persisted&&(W=t.timeStamp,e(t))},!0)},d=(e,t,r,n)=>{let i,o;return s=>{t.value>=0&&(s||n)&&(o=t.value-(i??0),(o||i===void 0)&&(i=t.value,t.delta=o,t.rating=((a,c)=>a>c[1]?"poor":a>c[0]?"needs-improvement":"good")(t.value,r),e(t)))}},I=e=>{requestAnimationFrame(()=>requestAnimationFrame(()=>e()))},M=()=>{const e=performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},y=()=>{const e=M();return(e==null?void 0:e.activationStart)??0},u=(e,t=-1)=>{const r=M();let n="navigate";return W>=0?n="back-forward-cache":r&&(document.prerendering||y()>0?n="prerender":document.wasDiscarded?n="restore":r.type&&(n=r.type.replace(/_/g,"-"))),{name:e,value:t,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},S=new WeakMap;function k(e,t){return S.get(e)||S.set(e,new t),S.get(e)}class G{constructor(){p(this,"t");p(this,"i",0);p(this,"o",[])}h(t){var i;if(t.hadRecentInput)return;const r=this.o[0],n=this.o.at(-1);this.i&&r&&n&&t.startTime-n.startTime<1e3&&t.startTime-r.startTime<5e3?(this.i+=t.value,this.o.push(t)):(this.i=t.value,this.o=[t]),(i=this.t)==null||i.call(this,t)}}const T=(e,t,r={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const n=new PerformanceObserver(i=>{Promise.resolve().then(()=>{t(i.getEntries())})});return n.observe({type:e,buffered:!0,...r}),n}}catch{}},B=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let m=-1;const $=new Set,F=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,L=e=>{if(document.visibilityState==="hidden"){if(e.type==="visibilitychange")for(const t of $)t();isFinite(m)||(m=e.type==="visibilitychange"?e.timeStamp:0,removeEventListener("prerenderingchange",L,!0))}},P=()=>{var e;if(m<0){const t=y();m=(document.prerendering||(e=globalThis.performance.getEntriesByType("visibility-state").filter(n=>n.name==="hidden"&&n.startTime>t)[0])==null?void 0:e.startTime)??F(),addEventListener("visibilitychange",L,!0),addEventListener("prerenderingchange",L,!0),g(()=>{setTimeout(()=>{m=F()})})}return{get firstHiddenTime(){return m},onHidden(t){$.add(t)}}},C=e=>{document.prerendering?addEventListener("prerenderingchange",()=>e(),!0):e()},H=[1800,3e3],j=(e,t={})=>{C(()=>{const r=P();let n,i=u("FCP");const o=T("paint",s=>{for(const a of s)a.name==="first-contentful-paint"&&(o.disconnect(),a.startTime<r.firstHiddenTime&&(i.value=Math.max(a.startTime-y(),0),i.entries.push(a),n(!0)))});o&&(n=d(e,i,H,t.reportAllChanges),g(s=>{i=u("FCP"),n=d(e,i,H,t.reportAllChanges),I(()=>{i.value=performance.now()-s.timeStamp,n(!0)})}))})},x=[.1,.25],K=(e,t={})=>{const r=P();j(B(()=>{let n,i=u("CLS",0);const o=k(t,G),s=c=>{for(const l of c)o.h(l);o.i>i.value&&(i.value=o.i,i.entries=o.o,n())},a=T("layout-shift",s);a&&(n=d(e,i,x,t.reportAllChanges),r.onHidden(()=>{s(a.takeRecords()),n(!0)}),g(()=>{o.i=0,i=u("CLS",0),n=d(e,i,x,t.reportAllChanges),I(()=>n())}),setTimeout(n))}))};let J=0,E=1/0,b=0;const Q=e=>{for(const t of e)t.interactionId&&(E=Math.min(E,t.interactionId),b=Math.max(b,t.interactionId),J=b?(b-E)/7+1:0)};let w;const N=()=>w?J:performance.interactionCount??0,U=()=>{"interactionCount"in performance||w||(w=T("event",Q,{type:"event",buffered:!0,durationThreshold:0}))};let O=0;class X{constructor(){p(this,"u",[]);p(this,"l",new Map);p(this,"m");p(this,"p")}v(){O=N(),this.u.length=0,this.l.clear()}L(){const t=Math.min(this.u.length-1,Math.floor((N()-O)/50));return this.u[t]}h(t){var i,o;if((i=this.m)==null||i.call(this,t),!t.interactionId&&t.entryType!=="first-input")return;const r=this.u.at(-1);let n=this.l.get(t.interactionId);if(n||this.u.length<10||t.duration>r.P){if(n?t.duration>n.P?(n.entries=[t],n.P=t.duration):t.duration===n.P&&t.startTime===n.entries[0].startTime&&n.entries.push(t):(n={id:t.interactionId,entries:[t],P:t.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort((s,a)=>a.P-s.P),this.u.length>10){const s=this.u.splice(10);for(const a of s)this.l.delete(a.id)}(o=this.p)==null||o.call(this,n)}}}const V=e=>{const t=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?e():(e=B(e),addEventListener("visibilitychange",e,{once:!0,capture:!0}),t(()=>{e(),removeEventListener("visibilitychange",e,{capture:!0})}))},q=[200,500],Y=(e,t={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;const r=P();C(()=>{U();let n,i=u("INP");const o=k(t,X),s=c=>{V(()=>{for(const h of c)o.h(h);const l=o.L();l&&l.P!==i.value&&(i.value=l.P,i.entries=l.entries,n())})},a=T("event",s,{durationThreshold:t.durationThreshold??40});n=d(e,i,q,t.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),r.onHidden(()=>{s(a.takeRecords()),n(!0)}),g(()=>{o.v(),i=u("INP"),n=d(e,i,q,t.reportAllChanges)}))})};class Z{constructor(){p(this,"m")}h(t){var r;(r=this.m)==null||r.call(this,t)}}const D=[2500,4e3],ee=(e,t={})=>{C(()=>{const r=P();let n,i=u("LCP");const o=k(t,Z),s=c=>{t.reportAllChanges||(c=c.slice(-1));for(const l of c)o.h(l),l.startTime<r.firstHiddenTime&&(i.value=Math.max(l.startTime-y(),0),i.entries=[l],n())},a=T("largest-contentful-paint",s);if(a){n=d(e,i,D,t.reportAllChanges);const c=B(()=>{s(a.takeRecords()),a.disconnect(),n(!0)}),l=h=>{h.isTrusted&&(V(c),removeEventListener(h.type,l,{capture:!0}))};for(const h of["keydown","click","visibilitychange"])addEventListener(h,l,{capture:!0});g(h=>{i=u("LCP"),n=d(e,i,D,t.reportAllChanges),I(()=>{i.value=performance.now()-h.timeStamp,n(!0)})})}})},R=[800,1800],A=e=>{document.prerendering?C(()=>A(e)):document.readyState!=="complete"?addEventListener("load",()=>A(e),!0):setTimeout(e)},te=(e,t={})=>{let r=u("TTFB"),n=d(e,r,R,t.reportAllChanges);A(()=>{const i=M();i&&(r.value=Math.max(i.responseStart-y(),0),r.entries=[i],n(!0),g(()=>{r=u("TTFB",0),n=d(e,r,R,t.reportAllChanges),n(!0)}))})};let v={cls:null,inp:null,lcp:null,fcp:null,ttfb:null};const ne=()=>{const e=document.querySelector('meta[name="page-design-type"]');return(e==null?void 0:e.getAttribute("content"))||void 0},f=e=>{const t={metricName:e.name,value:String(e.value),rating:e.rating,metricId:e.id,navigationType:e.navigationType||"navigate",pageDesignType:ne()};if(navigator.sendBeacon){const r=new Blob([JSON.stringify(t)],{type:"application/json"});navigator.sendBeacon("/api/analytics/vitals",r)}else fetch("/api/analytics/vitals",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"},keepalive:!0}).catch(console.error)},re=()=>{K(e=>{v.cls=e.value,f(e)}),Y(e=>{v.inp=e.value,f(e)}),ee(e=>{v.lcp=e.value,f(e)}),j(e=>{v.fcp=e.value,f(e)}),te(e=>{v.ttfb=e.value,f(e)})},ae=()=>({...v});export{ae as getWebVitals,re as initWebVitals};
