import{O as _,N as L,G as l,j as e,a as D,B as c,C as u,c as x,d as g,y as I,F as p,e as j,f as d,L as f,g as B}from"./index-CgsemtNf.js";import{B as b}from"./badge-CYF5D6iW.js";import{S as T}from"./separator-BU9ayPJf.js";import{A as N,b as C}from"./alert-p0mUESB5.js";import{C as h}from"./circle-x-DMZ_l0I7.js";import{K as P}from"./key-C_OmPl6Y.js";import{L as U}from"./link-CxA0ctwn.js";import{E as k}from"./external-link-Dqi3fO-u.js";import{T as Y}from"./trending-up-KAb4bHo1.js";function X(){const[,w]=_(),{toast:n}=L(),[o,r]=l.useState(!1),[y,v]=l.useState(!1),[s,A]=l.useState({hasBasicConfig:!1,isFullyConfigured:!1});l.useEffect(()=>{S();const t=new URLSearchParams(window.location.search),a=t.get("code"),i=t.get("state");a&&i?E(a,i):a&&n({title:"OAuth Failed",description:"Missing state parameter - security validation failed",variant:"destructive"})},[]);const S=async()=>{try{const a=await(await fetch("/api/google-ads/status")).json();A(a)}catch(t){console.error("Failed to check status:",t)}},E=async(t,a)=>{r(!0);try{const i=`${window.location.origin}/admin/google-ads-setup`,m=await fetch("/api/google-ads/oauth-callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t,redirectUri:i,state:a})});if(!m.ok){const R=await m.json();throw new Error(R.error||"Failed to complete OAuth")}const F=await m.json();n({title:"✅ OAuth Successful!",description:"Refresh token received. Please add it to your Replit Secrets as: GOOGLE_ADS_REFRESH_TOKEN"}),alert(`IMPORTANT: Add this refresh token to Replit Secrets:

Name: GOOGLE_ADS_REFRESH_TOKEN
Value: ${F.refresh_token}

Then refresh this page.`),window.history.replaceState({},document.title,"/admin/google-ads-setup"),await S()}catch(i){n({title:"OAuth Failed",description:i.message,variant:"destructive"})}finally{r(!1)}},O=async()=>{r(!0);try{const t=`${window.location.origin}/admin/google-ads-setup`,i=await(await fetch(`/api/google-ads/oauth-url?redirectUri=${encodeURIComponent(t)}`)).json();window.location.href=i.url}catch(t){n({title:"Failed to start OAuth",description:t.message,variant:"destructive"}),r(!1)}},G=async()=>{v(!0);try{const a=await(await fetch("/api/google-ads/test")).json();A(i=>({...i,connectionTest:a})),a.success?n({title:"✅ Connection Successful!",description:`Connected to: ${a.accountName}`}):n({title:"Connection Failed",description:a.message,variant:"destructive"})}catch(t){n({title:"Test Failed",description:t.message,variant:"destructive"})}finally{v(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(D,{}),e.jsx("main",{className:"flex-1 py-12",children:e.jsxs("div",{className:"container max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(c,{variant:"ghost",onClick:()=>w("/admin/analytics"),className:"mb-4","data-testid":"button-back",children:"← Back to Analytics"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Google Ads Integration Setup"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your Google Ads account to track paid vs organic conversions"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(u,{"data-testid":"card-setup-status",children:[e.jsxs(x,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Configuration Status"]}),e.jsx(p,{children:"Current setup progress"})]}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.hasBasicConfig?e.jsx(d,{className:"h-5 w-5 text-green-500"}):e.jsx(h,{className:"h-5 w-5 text-destructive"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Basic Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Client ID, Client Secret, Developer Token, Customer ID"})]}),e.jsx(b,{variant:s.hasBasicConfig?"default":"secondary",children:s.hasBasicConfig?"Complete":"Incomplete"})]}),e.jsx(T,{}),e.jsxs("div",{className:"flex items-center gap-3",children:[s.isFullyConfigured?e.jsx(d,{className:"h-5 w-5 text-green-500"}):e.jsx(h,{className:"h-5 w-5 text-destructive"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"OAuth Refresh Token"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Required for ongoing API access"})]}),e.jsx(b,{variant:s.isFullyConfigured?"default":"secondary",children:s.isFullyConfigured?"Complete":"Pending"})]}),s.connectionTest&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsxs("div",{className:"flex items-center gap-3",children:[s.connectionTest.success?e.jsx(d,{className:"h-5 w-5 text-green-500"}):e.jsx(h,{className:"h-5 w-5 text-destructive"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"API Connection Test"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.connectionTest.message}),s.connectionTest.accountName&&e.jsxs("p",{className:"text-sm font-medium text-primary mt-1",children:["Account: ",s.connectionTest.accountName]})]})]})]})]})})]}),!s.hasBasicConfig&&e.jsxs(N,{children:[e.jsx(P,{className:"h-4 w-4"}),e.jsxs(C,{children:[e.jsx("strong",{children:"Missing basic configuration."})," Please ensure you've added these 4 secrets to Replit:",e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"GOOGLE_ADS_CLIENT_ID"}),e.jsx("li",{children:"GOOGLE_ADS_CLIENT_SECRET"}),e.jsx("li",{children:"GOOGLE_ADS_DEVELOPER_TOKEN"}),e.jsx("li",{children:"GOOGLE_ADS_CUSTOMER_ID"})]})]})]}),s.hasBasicConfig&&!s.isFullyConfigured&&e.jsxs(u,{"data-testid":"card-oauth-setup",children:[e.jsxs(x,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"OAuth Authorization"]}),e.jsx(p,{children:"Authorize access to your Google Ads account"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click the button below to authorize this application to access your Google Ads data. You'll be redirected to Google to sign in and grant permissions."}),e.jsx(c,{onClick:O,disabled:o,size:"lg",className:"w-full","data-testid":"button-start-oauth",children:o?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}),"Redirecting to Google..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Authorize with Google Ads"]})}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"What happens next:"}),e.jsxs("ol",{className:"text-sm text-muted-foreground space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"You'll be redirected to Google's OAuth page"}),e.jsx("li",{children:"Sign in with your Google Ads account"}),e.jsx("li",{children:"Grant permission for this app to access your data"}),e.jsx("li",{children:"You'll receive a refresh token to add to Replit Secrets"}),e.jsx("li",{children:"Once added, the integration will be complete!"})]})]})]})]}),s.isFullyConfigured&&e.jsxs(u,{"data-testid":"card-connection-test",children:[e.jsxs(x,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Integration Active"]}),e.jsx(p,{children:"Your Google Ads account is connected"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs(N,{children:[e.jsx(d,{className:"h-4 w-4"}),e.jsxs(C,{children:[e.jsx("strong",{children:"Setup complete!"})," Your analytics dashboard will now show paid vs organic conversion data."]})]}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx(c,{onClick:G,disabled:y,variant:"outline","data-testid":"button-test-connection",children:y?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}),"Testing..."]}):"Test Connection"}),e.jsx(c,{onClick:O,disabled:o,variant:"outline","data-testid":"button-reconnect-oauth",children:o?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}),"Reconnecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Reconnect Account"]})}),e.jsx(c,{onClick:()=>w("/admin/analytics"),"data-testid":"button-view-analytics",children:"View Analytics Dashboard"})]}),s.connectionTest&&!s.connectionTest.success&&e.jsxs(N,{variant:"destructive",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsxs(C,{children:[e.jsx("strong",{children:"Connection test failed."}),' Your refresh token may be expired. Click "Reconnect Account" above to generate a new token.']})]})]})]})]})]})}),e.jsx(B,{})]})}export{X as default};
