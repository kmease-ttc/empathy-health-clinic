import{G as o,j as e,a9 as y,O as Ce,N as ke,u as ue,Q as Se,B as w,C as u,c as p,d as g,F as xe,e as j,W as Q,f as B,a1 as Ee,a7 as De}from"./index-CgsemtNf.js";import{T as he}from"./textarea-BXdjjUtM.js";import{B as pe}from"./badge-CYF5D6iW.js";import{L as A}from"./label-BjwbQxMY.js";import{C as N}from"./circle-alert-DGxppOlc.js";import{D as Me}from"./download-DxRUFOXP.js";import{H as He}from"./house-d9x4eLL5.js";import{S as ze}from"./search-CgS1i4Xf.js";import{T as _e}from"./trending-up-KAb4bHo1.js";const ge=o.forwardRef(({className:a,...l},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:y("w-full caption-bottom text-sm",a),...l})}));ge.displayName="Table";const je=o.forwardRef(({className:a,...l},r)=>e.jsx("thead",{ref:r,className:y("[&_tr]:border-b",a),...l}));je.displayName="TableHeader";const fe=o.forwardRef(({className:a,...l},r)=>e.jsx("tbody",{ref:r,className:y("[&_tr:last-child]:border-0",a),...l}));fe.displayName="TableBody";const Oe=o.forwardRef(({className:a,...l},r)=>e.jsx("tfoot",{ref:r,className:y("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...l}));Oe.displayName="TableFooter";const X=o.forwardRef(({className:a,...l},r)=>e.jsx("tr",{ref:r,className:y("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...l}));X.displayName="TableRow";const k=o.forwardRef(({className:a,...l},r)=>e.jsx("th",{ref:r,className:y("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...l}));k.displayName="TableHead";const S=o.forwardRef(({className:a,...l},r)=>e.jsx("td",{ref:r,className:y("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...l}));S.displayName="TableCell";const Re=o.forwardRef(({className:a,...l},r)=>e.jsx("caption",{ref:r,className:y("mt-4 text-sm text-muted-foreground",a),...l}));Re.displayName="TableCaption";const _={TITLE_MAX_LENGTH:60,DESCRIPTION_MIN_LENGTH:120,DESCRIPTION_MAX_LENGTH:160,DUPLICATE_H1_TITLE_PENALTY:15,KEYWORD_DENSITY_MIN:.5,KEYWORD_DENSITY_MAX:2.5};function Ie(a,l){var E;let r=100;const U=(a.metaTitle||a.title).toLowerCase(),M=a.content.toLowerCase(),b=l.toLowerCase(),T=M.match(/^#\s+(.+)$/m),H=T?T[1]:"",v=(a.metaTitle||a.title).trim(),O=H.trim();O&&v.toLowerCase()===O.toLowerCase()&&(r-=_.DUPLICATE_H1_TITLE_PENALTY),U.includes(b)||(r-=25),H.toLowerCase().includes(b)||(r-=20),(!a.metaDescription||a.metaDescription.length<_.DESCRIPTION_MIN_LENGTH)&&(r-=15),(E=a.metaDescription)!=null&&E.toLowerCase().includes(b)||(r-=15);const L=(M.match(new RegExp(b.replace(/\s+/g,"\\s+"),"gi"))||[]).length,$=a.content.split(/\s+/).length,R=L/$*100;return(R<_.KEYWORD_DENSITY_MIN||R>_.KEYWORD_DENSITY_MAX)&&(r-=25),Math.max(0,r)}function We(){var J,Z,ee,te,se,ie,re,ae,ne;const[,a]=Ce(),{toast:l}=ke(),[r,U]=o.useState(""),[M,b]=o.useState(null),[T,H]=o.useState("priority"),[v,O]=o.useState(!1),[L,$]=o.useState(!1),[R,E]=o.useState(!1),[c,D]=o.useState({}),{data:Y,isLoading:we}=ue({queryKey:["/api/blog-posts"]}),{data:F,isLoading:Ne}=ue({queryKey:["/api/semrush-data"]}),G=Se({mutationFn:async t=>await Ee("PATCH",`/api/blog-posts/${t.id}`,t.updates),onSuccess:()=>{De.invalidateQueries({queryKey:["/api/blog-posts"]}),l({title:"Success",description:"Blog post optimized successfully"}),E(!1),D({})},onError:t=>{l({title:"Error",description:t.message,variant:"destructive"})}}),I=(Y==null?void 0:Y.posts)||[],W=(F==null?void 0:F.data)||[],x=o.useMemo(()=>{let t=0;const i=W.map(s=>{let d=s.url;try{d=new URL(s.url,"https://empathyhealthclinic.com").pathname.toLowerCase().trim().replace(/\/$/,"")}catch{d=s.url.toLowerCase().trim().replace(/\/$/,"")}const f={url:d,keyword:s.keywords[0]||"",priority:s.priority,issues:s.issues.map(h=>h.replace(/_/g," ").replace(/\b\w/g,Le=>Le.toUpperCase())),missingKeywordIn:s.issues.filter(h=>h.startsWith("keyword_missing")).map(h=>h.replace("keyword_missing_in_","")),hasHighBounceRate:s.issues.includes("high_bounce_rate"),hasLowTimeOnPage:s.issues.includes("low_time_on_page"),missingInternalLinks:s.issues.includes("missing_internal_links")},C=d.replace(/^\/blog\//,"").replace(/^\//,""),n=I.find(h=>h.slug===C||`/blog/${h.slug}`===d||h.slug===d.replace(/^\//,""));if(!n)return t++,console.log(`⚠️ SEMrush URL not matched: ${s.url} → ${d} (slug: ${C})`),{url:f.url,slug:C,currentTitle:"",currentMetaTitle:"",currentMetaDescription:"",currentH1:"",currentKeywords:[],targetKeywords:s.keywords,priority:f.priority,issues:f.issues,optimizationScore:0};const P=n.content.match(/^#\s+(.+)$/m),le=P?P[1]:"",oe=(n.metaTitle||n.title).trim(),ce=le.trim(),de=!!(ce&&oe.toLowerCase()===ce.toLowerCase()),me=oe.length>_.TITLE_MAX_LENGTH;let q=[...f.issues];return de&&q.push("Duplicate H1 And Title"),me&&q.push("Title Too Long"),{url:f.url,slug:n.slug,currentTitle:n.title,currentMetaTitle:n.metaTitle||n.title,currentMetaDescription:n.metaDescription||n.excerpt,currentH1:le,currentKeywords:n.keywords||[],targetKeywords:s.keywords,priority:f.priority,issues:q,optimizationScore:Ie(n,s.keywords[0]||""),hasDuplicateH1Title:de,hasTitleTooLong:me}});return t>0&&console.log(`ℹ️ Total unmatched SEMrush URLs: ${t} out of ${W.length}`),i.filter(s=>s.currentTitle.toLowerCase().includes(r.toLowerCase())||s.slug.toLowerCase().includes(r.toLowerCase())||s.targetKeywords.some(d=>d.toLowerCase().includes(r.toLowerCase())))},[I,W,r]),V=o.useMemo(()=>{let t=[...x];return v&&(t=t.filter(i=>i.hasDuplicateH1Title)),L&&(t=t.filter(i=>i.hasTitleTooLong)),t.sort((i,s)=>T==="priority"?s.priority-i.priority:i.optimizationScore-s.optimizationScore)},[x,T,v,L]),m=M?x.find(t=>t.url===M):null,K=m?I.find(t=>t.slug===m.slug):null,ye=t=>{b(t);const i=x.find(d=>d.url===t),s=I.find(d=>d.slug===(i==null?void 0:i.slug));s&&i&&(D({title:s.title,metaTitle:s.metaTitle||s.title,metaDescription:s.metaDescription||s.excerpt,keywords:s.keywords||[],content:s.content}),E(!0))},be=()=>{K&&G.mutate({id:K.id,updates:c})},Te=()=>{const t=["Priority","URL","Target Keyword","Current Score","Issues","Title","Meta Title","Meta Description","H1"],i=V.map(n=>[n.priority.toFixed(2),n.url,n.targetKeywords.join("; "),n.optimizationScore.toString(),n.issues.join("; "),n.currentTitle,n.currentMetaTitle,n.currentMetaDescription,n.currentH1]),s=[t,...i].map(n=>n.map(P=>`"${P.replace(/"/g,'""')}"`).join(",")).join(`
`),d=new Blob([s],{type:"text/csv"}),f=URL.createObjectURL(d),C=document.createElement("a");C.href=f,C.download=`semrush-optimization-${new Date().toISOString().split("T")[0]}.csv`,C.click(),URL.revokeObjectURL(f),l({title:"Export Complete",description:"SEMrush optimization data exported to CSV"})},ve=x.length>0?x.reduce((t,i)=>t+i.optimizationScore,0)/x.length:0,z=o.useMemo(()=>{const t={highBounceRate:0,lowTimeOnPage:0,missingLinks:0,poorOptimization:0,duplicateH1Title:0,titleTooLong:0};return x.forEach(i=>{i.issues.includes("High bounce rate")&&t.highBounceRate++,i.issues.includes("Low time on page")&&t.lowTimeOnPage++,i.issues.includes("Missing internal links")&&t.missingLinks++,i.issues.includes("Duplicate H1 And Title")&&t.duplicateH1Title++,i.issues.includes("Title Too Long")&&t.titleTooLong++,i.optimizationScore<60&&t.poorOptimization++}),t},[x]);return we||Ne?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading SEMrush data..."})]})}):R&&K&&m?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border sticky top-0 bg-background/95 backdrop-blur-md z-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-sans font-medium",children:["Optimize: ",m.currentTitle]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Target: ",m.targetKeywords.join(", ")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>{E(!1),b(null)},"data-testid":"button-cancel",children:"Cancel"}),e.jsx(w,{onClick:be,disabled:G.isPending,"data-testid":"button-save",children:G.isPending?"Saving...":"Save Changes"})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(u,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"SEO Metadata"}),e.jsx(xe,{children:"Optimize title tags and meta descriptions for target keyword"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Meta Title"}),e.jsx(Q,{value:c.metaTitle||"",onChange:t=>D({...c,metaTitle:t.target.value}),placeholder:"Include target keyword in title","data-testid":"input-meta-title"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[((J=c.metaTitle)==null?void 0:J.length)||0,"/60 characters"]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Meta Description"}),e.jsx(he,{value:c.metaDescription||"",onChange:t=>D({...c,metaDescription:t.target.value}),placeholder:"Include target keyword naturally",rows:3,"data-testid":"textarea-meta-description"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[((Z=c.metaDescription)==null?void 0:Z.length)||0,"/160 characters"]})]}),e.jsxs("div",{children:[e.jsx(A,{children:"Target Keywords (comma-separated)"}),e.jsx(Q,{value:((ee=c.keywords)==null?void 0:ee.join(", "))||"",onChange:t=>D({...c,keywords:t.target.value.split(",").map(i=>i.trim())}),placeholder:"love bombing meaning, love bombing definition","data-testid":"input-keywords"})]})]})]}),e.jsxs(u,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Content Optimization"}),e.jsx(xe,{children:"Ensure H1 and body content include target keyword"})]}),e.jsx(j,{children:e.jsxs("div",{children:[e.jsx(A,{children:"Content Preview (First 500 characters)"}),e.jsx(he,{value:((te=c.content)==null?void 0:te.slice(0,500))||"",onChange:t=>D({...c,content:t.target.value+(K.content.slice(500)||"")}),rows:10,"data-testid":"textarea-content-preview"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Edit the opening to include target keyword in first paragraph"})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(g,{children:"Optimization Checklist"})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[(se=c.metaTitle)!=null&&se.toLowerCase().includes(m.targetKeywords[0].toLowerCase())?e.jsx(B,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(N,{className:"h-5 w-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Keyword in Title"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:['Include "',m.targetKeywords[0],'" in title']})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[(ie=c.metaDescription)!=null&&ie.toLowerCase().includes(m.targetKeywords[0].toLowerCase())?e.jsx(B,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(N,{className:"h-5 w-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Keyword in Meta Description"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:['Include "',m.targetKeywords[0],'" naturally']})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[(((re=c.metaDescription)==null?void 0:re.length)||0)>=120&&(((ae=c.metaDescription)==null?void 0:ae.length)||0)<=160?e.jsx(B,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(N,{className:"h-5 w-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Meta Description Length"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"120-160 characters recommended"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[(ne=c.content)!=null&&ne.toLowerCase().includes(m.targetKeywords[0].toLowerCase())?e.jsx(B,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(N,{className:"h-5 w-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Keyword in Content"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Include naturally throughout article"})]})]})]})]}),e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(g,{children:"SEMrush Issues"})}),e.jsx(j,{className:"space-y-2",children:m.issues.map((t,i)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm",children:t})]},i))})]})]})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border sticky top-0 bg-background/95 backdrop-blur-md z-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-sans font-medium",children:"SEMrush Keyword Optimizer"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Bulk optimization for ",x.length," priority pages"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",onClick:Te,"data-testid":"button-export-csv",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Export CSV"]}),e.jsxs(w,{variant:"outline",onClick:()=>a("/admin"),"data-testid":"button-back-to-admin",children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Back to Admin"]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"grid md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:[e.jsxs(u,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:"Average Score"})}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(ve),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Keyword optimization"})]})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:"Duplicate H1"})}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:z.duplicateH1Title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"H1 = Title"})]})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:"Title Too Long"})}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:z.titleTooLong}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Over 60 chars"})]})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:"High Bounce"})}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:z.highBounceRate}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Pages affected"})]})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:"Missing Links"})}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:z.missingLinks}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Need internal links"})]})]}),e.jsxs(u,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:"Poor Score"})}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:z.poorOptimization}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Below 60%"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{placeholder:"Search by URL or keyword...",value:r,onChange:t=>U(t.target.value),className:"pl-10","data-testid":"input-search"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:T==="priority"?"default":"outline",size:"sm",onClick:()=>H("priority"),"data-testid":"button-sort-priority",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Priority"]}),e.jsxs(w,{variant:T==="score"?"default":"outline",size:"sm",onClick:()=>H("score"),"data-testid":"button-sort-score",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Score"]}),e.jsxs(w,{variant:v?"default":"outline",size:"sm",onClick:()=>O(!v),"data-testid":"button-filter-duplicate-h1",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),v?"Show All":"H1=Title"]}),e.jsxs(w,{variant:L?"default":"outline",size:"sm",onClick:()=>$(!L),"data-testid":"button-filter-title-too-long",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),L?"Show All":"Long Titles"]})]})]}),e.jsx(u,{children:e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs(X,{children:[e.jsx(k,{children:"Priority"}),e.jsx(k,{children:"URL"}),e.jsx(k,{children:"Target Keyword"}),e.jsx(k,{children:"Score"}),e.jsx(k,{children:"Issues"}),e.jsx(k,{children:"Actions"})]})}),e.jsx(fe,{children:V.map(t=>e.jsxs(X,{children:[e.jsx(S,{children:e.jsx(pe,{variant:t.priority>=.5?"destructive":t.priority>=.3?"default":"secondary",children:t.priority.toFixed(2)})}),e.jsx(S,{className:"font-mono text-sm",children:t.url}),e.jsx(S,{children:t.targetKeywords.join(", ")}),e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-muted rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.optimizationScore>=80?"bg-green-600":t.optimizationScore>=60?"bg-yellow-600":"bg-red-600"}`,style:{width:`${t.optimizationScore}%`}})}),e.jsxs("span",{className:"text-sm",children:[t.optimizationScore,"%"]})]})}),e.jsx(S,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:t.issues.map((i,s)=>e.jsx(pe,{variant:"outline",className:"text-xs",children:i.replace("High bounce rate","Bounce").replace("Low time on page","Time").replace("Missing internal links","Links")},s))})}),e.jsx(S,{children:e.jsx(w,{size:"sm",variant:"outline",onClick:()=>ye(t.url),disabled:!t.currentTitle,"data-testid":`button-optimize-${t.slug}`,children:"Optimize"})})]},t.url))})]})})]})]})}export{We as default};
