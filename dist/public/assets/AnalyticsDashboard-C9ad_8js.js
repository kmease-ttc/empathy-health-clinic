import{O as J,N as Q,G as E,u as k,j as e,A as S,Y,Z as z,r as V,_ as H,$ as Z,a0 as T,B as b,C as d,c as o,d as m,e as l,f as N,F as v,U as M,P as G,V as X,m as ee,M as se,a8 as te,a7 as R,t as ae}from"./index-CgsemtNf.js";import{P as L}from"./progress-B7OgBQCH.js";import{B as p}from"./badge-CYF5D6iW.js";import{S as F}from"./separator-BU9ayPJf.js";import{D as re,b as ie,c as ne,d as de,e as le}from"./dialog-C65p-0H7.js";import{R as ce}from"./refresh-cw-BXMHVCn8.js";import{C as I}from"./circle-alert-DGxppOlc.js";import{T as P}from"./trending-up-KAb4bHo1.js";import{E as q}from"./eye-DwJHXLxg.js";import{Z as oe}from"./zap-CtifTebD.js";import{F as A}from"./file-text-DR4XjJnC.js";import{U as me}from"./user-CnprKFnV.js";function xe(w,x){const h={LCP:{good:2500,needsImprovement:4e3,max:6e3},INP:{good:200,needsImprovement:500,max:1e3},CLS:{good:.1,needsImprovement:.25,max:.5},FCP:{good:1800,needsImprovement:3e3,max:5e3},TTFB:{good:800,needsImprovement:1800,max:3e3}}[w];if(!h)return{rating:"unknown",color:"bg-muted",percentage:0};let j,u,t;return x<=h.good?(j="good",u="bg-green-500",t=x/h.good*33):x<=h.needsImprovement?(j="needs-improvement",u="bg-yellow-500",t=33+(x-h.good)/(h.needsImprovement-h.good)*33):(j="poor",u="bg-red-500",t=66+Math.min((x-h.needsImprovement)/(h.max-h.needsImprovement)*34,34)),{rating:j,color:u,percentage:Math.min(t,100)}}function he(w,x){return w==="CLS"?x.toFixed(3):`${Math.round(x)}ms`}function De(){const[,w]=J(),{toast:x}=Q(),[c,h]=E.useState("today"),j=te(),u="G-JKLLK1WJ47",{data:t,isLoading:_,refetch:O}=k({queryKey:["/api/analytics/dashboard",c],queryFn:async()=>{const s=await fetch(`/api/analytics/dashboard?timeRange=${c}`);if(!s.ok)throw new Error("Failed to fetch analytics");return s.json()}}),{data:r}=k({queryKey:["/api/analytics/forms",c],queryFn:async()=>{const s=await fetch(`/api/analytics/forms?timeRange=${c}`);if(!s.ok)throw new Error("Failed to fetch form metrics");return s.json()}}),{data:y,isLoading:B}=k({queryKey:["/api/leads"]}),{data:C}=k({queryKey:["/api/google-ads/status"],retry:!1}),{data:g,isLoading:K}=k({queryKey:["/api/google-ads/conversions",c],queryFn:async()=>{const s=new Date;let a,i=s.toISOString().split("T")[0];c==="today"?a=i:c==="7d"?a=new Date(s.getTime()-6048e5).toISOString().split("T")[0]:c==="30d"?a=new Date(s.getTime()-2592e6).toISOString().split("T")[0]:a=new Date(s.getTime()-7776e6).toISOString().split("T")[0];const n=await fetch(`/api/google-ads/conversions?startDate=${a}&endDate=${i}`);return n.ok?n.json():null},enabled:(C==null?void 0:C.isFullyConfigured)===!0,retry:!1,staleTime:4*60*60*1e3,refetchInterval:8*60*60*1e3,refetchOnWindowFocus:!0}),[f,$]=E.useState(null),U=()=>{R.invalidateQueries({queryKey:["/api/analytics/dashboard"]}),R.invalidateQueries({queryKey:["/api/analytics/forms"]}),R.invalidateQueries({queryKey:["/api/leads"]}),O()},W=()=>{ae("test_analytics_tracking","admin","Dashboard Test","manual_test");const s=typeof window.gtag<"u";x({title:"‚úÖ Test Event Sent!",description:e.jsxs("div",{className:"space-y-2 mt-2","data-testid":"toast-ga-test",children:[e.jsx("div",{className:"font-semibold",children:"Configuration Status:"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:["‚Ä¢ GA Measurement ID: ","‚úì Configured"]}),e.jsxs("div",{children:["‚Ä¢ gtag loaded: ",s?"‚úì Yes":"‚úó No"]}),e.jsxs("div",{children:["‚Ä¢ GA Active: ",j?"‚úì Yes":"‚úó No"]})]}),e.jsx("div",{className:"text-sm text-muted-foreground mt-3 pt-2 border-t",children:"Check GA4 Realtime reports to see this event appear within 60 seconds."})]}),duration:8e3}),console.log("üìä GA Configuration Test Results:",{measurementId:(u==null?void 0:u.substring(0,10))+"...",gtagLoaded:s,gaActive:j,testEventSent:!0})};return _?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"h-12 w-12 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading analytics data..."})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b sticky top-0 bg-background/95 backdrop-blur-md z-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-sans font-medium","data-testid":"text-page-title",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Site health, web vitals, and user engagement metrics"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs(Y,{value:c,onValueChange:h,children:[e.jsxs(z,{className:"w-[180px]","data-testid":"select-time-range",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),e.jsx(H,{placeholder:"Select time range"})]}),e.jsxs(Z,{children:[e.jsx(T,{value:"today",children:"Today"}),e.jsx(T,{value:"7d",children:"Last 7 Days"}),e.jsx(T,{value:"30d",children:"Last 30 Days"}),e.jsx(T,{value:"all",children:"All Time"})]})]}),e.jsxs(b,{variant:"outline",onClick:U,"data-testid":"button-refresh",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsx(b,{variant:"outline",onClick:()=>w("/admin"),"data-testid":"button-back-admin",children:"Back to Admin"})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8 space-y-8",children:[e.jsxs(d,{"data-testid":"card-ga-status",children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),"Google Analytics Status"]})}),e.jsx(l,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[j?e.jsx(N,{className:"h-6 w-6 text-green-500","data-testid":"icon-ga-active"}):e.jsx(I,{className:"h-6 w-6 text-yellow-500","data-testid":"icon-ga-inactive"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium","data-testid":"text-ga-status",children:j?"Active & Tracking":"Not Configured"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j?`Measurement ID: ${u==null?void 0:u.substring(0,8)}...`:"Set VITE_GA_MEASUREMENT_ID to enable tracking"})]})]}),j&&e.jsx(b,{variant:"outline",onClick:W,"data-testid":"button-test-ga",children:"Test Tracking"})]})})]}),e.jsxs(d,{"data-testid":"card-gsc-status",children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Google Search Console Status"]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"h-6 w-6 text-green-500","data-testid":"icon-gsc-configured"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium","data-testid":"text-gsc-status",children:"Verification Meta Tag Configured"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Site ready for Google Search Console verification"})]})]}),e.jsx(b,{variant:"outline",onClick:()=>window.open("https://search.google.com/search-console","_blank"),"data-testid":"button-open-gsc",children:"Open Search Console"})]}),!1]})]}),e.jsxs(d,{"data-testid":"card-clarity-status",className:"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-950 dark:to-purple-950 border-2",children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),"Microsoft Clarity - Behavior Analytics"]}),e.jsx(v,{children:"Understand why visitors drop off with heatmaps, session recordings, and scroll maps"})]}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"h-6 w-6 text-green-500","data-testid":"icon-clarity-active"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium","data-testid":"text-clarity-status",children:"Active & Recording Sessions"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:`Project ID: ${"u21s08irgz".substring(0,8)}...`})]})]}),e.jsx(b,{variant:"outline",onClick:()=>window.open("https://clarity.microsoft.com/","_blank"),"data-testid":"button-open-clarity",children:"Open Clarity Dashboard"})]}),e.jsxs("div",{className:"bg-card p-4 rounded-md border space-y-3",children:[e.jsx("p",{className:"font-medium text-sm",children:"What You Can See in Clarity:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-green-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Heatmaps"}),e.jsx("p",{className:"text-muted-foreground",children:"See exactly where visitors click most"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-green-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Session Recordings"}),e.jsx("p",{className:"text-muted-foreground",children:"Watch visitor journeys from start to finish"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-green-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Scroll Maps"}),e.jsx("p",{className:"text-muted-foreground",children:"Identify where people stop scrolling"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-green-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Rage Clicks"}),e.jsx("p",{className:"text-muted-foreground",children:"Find broken buttons causing frustration"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-green-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Dead Clicks"}),e.jsx("p",{className:"text-muted-foreground",children:"Discover non-clickable elements users try to click"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-green-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Form Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"See which form fields cause drop-offs"})]})]})]})]})]})]}),e.jsxs(d,{"data-testid":"card-conversion-sources",children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Conversion Sources (Paid vs Organic)"]}),e.jsx(v,{children:"Track where your leads come from - paid ads vs organic search"})]}),e.jsx(l,{className:"space-y-4",children:C!=null&&C.isFullyConfigured?K?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-primary"})}):g&&g.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Paid Conversions"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-paid-conversions",children:g.reduce((s,a)=>s+(a.conversions||0),0).toFixed(0)})]}),e.jsxs("div",{className:"p-4 rounded-lg border",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Ad Spend"}),e.jsxs("p",{className:"text-2xl font-bold","data-testid":"text-ad-spend",children:["$",g.reduce((s,a)=>s+(a.cost||0),0).toFixed(2)]})]}),e.jsxs("div",{className:"p-4 rounded-lg border",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Cost Per Conversion"}),e.jsxs("p",{className:"text-2xl font-bold","data-testid":"text-cost-per-conversion",children:["$",(()=>{const s=g.reduce((i,n)=>i+(n.conversions||0),0),a=g.reduce((i,n)=>i+(n.cost||0),0);return s>0?(a/s).toFixed(2):"0.00"})()]})]}),e.jsxs("div",{className:"p-4 rounded-lg border",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Organic Conversions"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400","data-testid":"text-organic-conversions",children:Math.max(0,((t==null?void 0:t.conversions.totalLeads)||0)-g.reduce((s,a)=>s+(a.conversions||0),0))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Free traffic!"})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-muted/50",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Conversion Breakdown"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-sm",children:"Paid (Google Ads)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold",children:g.reduce((s,a)=>s+(a.conversions||0),0).toFixed(0)}),e.jsxs(p,{variant:"secondary",children:[(g.reduce((s,a)=>s+(a.conversions||0),0)/((t==null?void 0:t.conversions.totalLeads)||1)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-sm",children:"Organic (Free Search)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold",children:Math.max(0,((t==null?void 0:t.conversions.totalLeads)||0)-g.reduce((s,a)=>s+(a.conversions||0),0))}),e.jsxs(p,{variant:"default",children:[((((t==null?void 0:t.conversions.totalLeads)||0)-g.reduce((s,a)=>s+(a.conversions||0),0))/((t==null?void 0:t.conversions.totalLeads)||1)*100).toFixed(1),"%"]})]})]})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No Google Ads conversion data for this time period"}),e.jsx("p",{className:"text-sm mt-2",children:"Try selecting a different time range"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-6 w-6 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Google Ads Not Connected"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect your Google Ads account to track paid vs organic conversions"})]})]}),e.jsx(b,{onClick:()=>w("/admin/google-ads-setup"),"data-testid":"button-setup-google-ads",children:"Set Up Google Ads Integration"})]})})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),"Core Web Vitals"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t!=null&&t.vitals&&t.vitals.length>0?t.vitals.map(s=>{const{rating:a,color:i,percentage:n}=xe(s.metricName,s.avgValue),D=he(s.metricName,s.avgValue);return e.jsxs(d,{"data-testid":`card-vital-${s.metricName}`,children:[e.jsxs(o,{className:"pb-3",children:[e.jsxs(m,{className:"text-base font-medium flex items-center justify-between",children:[e.jsx("span",{children:s.metricName}),e.jsx(p,{variant:a==="good"?"default":a==="needs-improvement"?"secondary":"destructive","data-testid":`badge-rating-${s.metricName}`,children:a})]}),e.jsxs(v,{className:"text-xs",children:[s.metricName==="LCP"&&"Largest Contentful Paint",s.metricName==="INP"&&"Interaction to Next Paint",s.metricName==="CLS"&&"Cumulative Layout Shift",s.metricName==="FCP"&&"First Contentful Paint",s.metricName==="TTFB"&&"Time to First Byte"]})]}),e.jsxs(l,{className:"space-y-3",children:[e.jsx("div",{className:"text-3xl font-bold","data-testid":`text-value-${s.metricName}`,children:D}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Performance"}),e.jsxs("span",{children:[Math.round(n),"%"]})]}),e.jsx(L,{value:n,className:"h-2","data-testid":`progress-${s.metricName}`})]})]})]},s.metricName)}):e.jsx(d,{className:"md:col-span-2 lg:col-span-3",children:e.jsxs(l,{className:"py-12 text-center",children:[e.jsx(I,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No web vitals data available yet. Data will appear as users visit the site."})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(d,{"data-testid":"card-page-views",children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2 text-base",children:[e.jsx(q,{className:"h-4 w-4"}),"Page Views"]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:c==="today"?"Today":c==="7d"?"Last 7 Days":c==="30d"?"Last 30 Days":"Total (All Time)"}),e.jsx("p",{className:"text-3xl font-bold","data-testid":"text-total-views",children:(t==null?void 0:t.pageViews.total.toLocaleString())||0})]}),e.jsx(F,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Last 7 Days"}),e.jsx("span",{className:"font-semibold","data-testid":"text-views-7d",children:(t==null?void 0:t.pageViews.last7Days.toLocaleString())||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Last 30 Days"}),e.jsx("span",{className:"font-semibold","data-testid":"text-views-30d",children:(t==null?void 0:t.pageViews.last30Days.toLocaleString())||0})]})]})]})]}),e.jsxs(d,{"data-testid":"card-leads",children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2 text-base",children:[e.jsx(M,{className:"h-4 w-4"}),"Total Leads"]})}),e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Captured Leads"}),e.jsx("p",{className:"text-3xl font-bold","data-testid":"text-total-leads",children:(t==null?void 0:t.conversions.totalLeads.toLocaleString())||0})]})})]}),e.jsxs(d,{"data-testid":"card-total-events",children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2 text-base",children:[e.jsx(P,{className:"h-4 w-4"}),"Total Events"]})}),e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"All Tracked Events"}),e.jsx("p",{className:"text-3xl font-bold","data-testid":"text-total-events",children:(t==null?void 0:t.events.total.toLocaleString())||0})]})})]})]}),e.jsxs(d,{"data-testid":"card-conversions",children:[e.jsxs(o,{children:[e.jsx(m,{children:"Conversions & Events"}),e.jsx(v,{children:"User interactions and conversion tracking"})]}),e.jsx(l,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border hover-elevate","data-testid":"stat-form-submissions",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(A,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.conversions.formSubmissions)||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Form Submissions"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border hover-elevate","data-testid":"stat-phone-clicks",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(G,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.conversions.phoneClicks)||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Phone Clicks"}),e.jsx(b,{size:"sm",variant:"outline",className:"mt-2",onClick:async()=>{try{if(!(await fetch("/api/analytics/event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventType:"phone_click",eventCategory:"conversion",eventLabel:"Manual Entry - Google Ads",value:"386-848-8751",path:"/google-ads-manual-entry"})})).ok)throw new Error("Failed to log phone call");x({title:"üìû Phone Call Logged",description:"Phone call has been added to analytics"}),O()}catch(s){x({title:"‚ùå Error",description:s instanceof Error?s.message:"Failed to log phone call",variant:"destructive"})}},children:"+ Add Phone Call"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border hover-elevate","data-testid":"stat-virtual-visits",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(X,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.conversions.virtualVisitRequests)||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Virtual Visit Requests"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border hover-elevate","data-testid":"stat-other-events",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(S,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:Math.max(0,((t==null?void 0:t.events.total)||0)-((t==null?void 0:t.conversions.phoneClicks)||0)-((t==null?void 0:t.conversions.virtualVisitRequests)||0))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Other Events"})]})]})]})})]}),r&&e.jsxs(d,{"data-testid":"card-form-metrics",children:[e.jsxs(o,{children:[e.jsx(m,{children:"Form Conversion Metrics"}),e.jsx(v,{children:"Short vs long form submissions and drop-off rates"})]}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 rounded-lg border",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-primary"}),"Short Contact Form"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Started"}),e.jsx("span",{className:"font-semibold","data-testid":"text-short-form-starts",children:r.shortFormStarts})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Submitted"}),e.jsx("span",{className:"font-semibold","data-testid":"text-short-form-submissions",children:r.shortFormSubmissions})]}),e.jsx(F,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Drop-off Rate"}),e.jsxs(p,{variant:r.shortFormDropOffRate<30?"default":r.shortFormDropOffRate<60?"secondary":"destructive","data-testid":"badge-short-form-dropoff",children:[r.shortFormDropOffRate.toFixed(1),"%"]})]}),e.jsx(L,{value:r.shortFormDropOffRate,className:"h-2","data-testid":"progress-short-form-dropoff"})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-primary"}),"Long Contact Form"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Started"}),e.jsx("span",{className:"font-semibold","data-testid":"text-long-form-starts",children:r.longFormStarts})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Submitted"}),e.jsx("span",{className:"font-semibold","data-testid":"text-long-form-submissions",children:r.longFormSubmissions})]}),e.jsx(F,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Drop-off Rate"}),e.jsxs(p,{variant:r.longFormDropOffRate<30?"default":r.longFormDropOffRate<60?"secondary":"destructive","data-testid":"badge-long-form-dropoff",children:[r.longFormDropOffRate.toFixed(1),"%"]})]}),e.jsx(L,{value:r.longFormDropOffRate,className:"h-2","data-testid":"progress-long-form-dropoff"})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Overall Form Performance"]}),e.jsxs(p,{variant:r.totalDropOffRate<30?"default":r.totalDropOffRate<60?"secondary":"destructive","data-testid":"badge-total-dropoff",children:[r.totalDropOffRate.toFixed(1),"% drop-off"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r.shortFormStarts+r.longFormStarts}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Started"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r.shortFormSubmissions+r.longFormSubmissions}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Submitted"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r.shortFormSubmissions}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Short Forms"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r.longFormSubmissions}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Long Forms"})]})]})]})]})})]}),(t==null?void 0:t.pageViews.topPages)&&t.pageViews.topPages.length>0&&e.jsxs(d,{"data-testid":"card-top-pages",children:[e.jsxs(o,{children:[e.jsx(m,{children:"Top Pages"}),e.jsx(v,{children:"Most visited pages on your site"})]}),e.jsx(l,{children:e.jsx("div",{className:"space-y-3",children:t.pageViews.topPages.map((s,a)=>{var i;return e.jsxs("div",{className:"flex items-center justify-between gap-4 p-3 rounded-lg border hover-elevate","data-testid":`page-stat-${a}`,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(p,{variant:"outline",className:"shrink-0",children:a+1}),e.jsx("span",{className:"text-sm font-medium truncate",children:s.path||"/"})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.count," views"]}),e.jsx("div",{className:"w-24",children:e.jsx(L,{value:s.count/(((i=t.pageViews.topPages[0])==null?void 0:i.count)||1)*100,className:"h-2"})})]})]},s.path)})})})]}),(()=>{var a;const s=((a=t==null?void 0:t.events.recent)==null?void 0:a.filter(i=>i.eventType!=="virtual_visit_click"))||[];return s.length>0&&e.jsxs(d,{"data-testid":"card-recent-activity",children:[e.jsxs(o,{children:[e.jsx(m,{children:"Recent Activity"}),e.jsx(v,{children:"Latest tracked events (excluding virtual visits from current clients)"})]}),e.jsx(l,{children:e.jsx("div",{className:"space-y-2",children:s.slice(0,20).map((i,n)=>e.jsxs("div",{className:"flex items-center justify-between gap-4 p-3 rounded-lg border text-sm cursor-pointer hover-elevate active-elevate-2",onClick:()=>$(i),"data-testid":`event-${n}`,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium truncate",children:i.eventType}),i.eventLabel&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:i.eventLabel})]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx(p,{variant:"outline",children:i.eventCategory}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(i.timestamp).toLocaleString()})]})]},i.id||n))})})]})})(),e.jsx(re,{open:!!f,onOpenChange:s=>!s&&$(null),children:e.jsxs(ie,{className:"max-w-2xl",children:[e.jsxs(ne,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),"Event Details"]}),e.jsx(le,{children:"Complete information about this tracked event"})]}),f&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Event Type"}),e.jsx("p",{className:"text-base font-semibold","data-testid":"dialog-event-type",children:f.eventType})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Category"}),e.jsx(p,{variant:"outline","data-testid":"dialog-event-category",children:f.eventCategory})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Timestamp"}),e.jsx("p",{className:"text-base","data-testid":"dialog-event-timestamp",children:new Date(f.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Page Path"}),e.jsx("p",{className:"text-base font-mono text-sm","data-testid":"dialog-event-path",children:f.path})]})]}),e.jsx(F,{}),f.eventLabel&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Event Label"}),e.jsx("p",{className:"text-base","data-testid":"dialog-event-label",children:f.eventLabel})]}),f.value&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Value"}),e.jsx("p",{className:"text-base","data-testid":"dialog-event-value",children:f.value})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Event ID"}),e.jsx("p",{className:"text-xs font-mono text-muted-foreground","data-testid":"dialog-event-id",children:f.id})]})]})]})}),e.jsxs(d,{"data-testid":"card-lead-submissions",children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Lead Submissions"]}),e.jsxs(v,{className:"flex items-center gap-4 flex-wrap",children:[e.jsx("span",{children:"All form submissions from your website (most recent first)"}),y&&y.length>0&&(()=>{const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),i=y.filter(n=>new Date(n.createdAt)>=a);return e.jsxs(p,{variant:"secondary",className:"ml-auto","data-testid":"badge-today-leads",children:[i.length," today ¬∑ ",y.length," total"]})})()]})]}),e.jsx(l,{children:B?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-primary"})}):!y||y.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No lead submissions yet"}):e.jsx("div",{className:"space-y-4",children:y.map((s,a)=>e.jsxs("div",{className:"p-4 rounded-lg border hover-elevate","data-testid":`lead-${a}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(me,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold","data-testid":`lead-name-${a}`,children:[s.firstName," ",s.lastName]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[e.jsx(p,{variant:"outline","data-testid":`lead-form-type-${a}`,children:s.formType==="long"?"Full Application":s.formType==="phone_click"?"Phone Click":"Quick Contact"}),s.source&&e.jsxs("span",{className:"text-xs text-muted-foreground","data-testid":`lead-source-${a}`,children:["Source: ",s.source]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),new Date(s.createdAt).toLocaleDateString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleTimeString()})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Email:"}),e.jsx("a",{href:`mailto:${s.email}`,className:"text-primary hover:underline","data-testid":`lead-email-${a}`,children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Phone:"}),e.jsx("a",{href:`tel:${s.phone}`,className:"text-primary hover:underline","data-testid":`lead-phone-${a}`,children:s.phone})]}),s.service&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Service:"}),e.jsx("span",{"data-testid":`lead-service-${a}`,children:s.service})]}),s.smsOptIn==="true"&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(p,{variant:"secondary",className:"text-xs",children:"SMS Opt-in"})})]}),s.formType==="long"&&e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"my-3"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.conditions&&s.conditions!=="[]"&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground font-medium",children:"Conditions:"}),e.jsx("p",{className:"mt-1","data-testid":`lead-conditions-${a}`,children:JSON.parse(s.conditions).join(", ")})]}),s.symptoms&&s.symptoms!=="[]"&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground font-medium",children:"Symptoms:"}),e.jsx("p",{className:"mt-1","data-testid":`lead-symptoms-${a}`,children:JSON.parse(s.symptoms).join(", ")})]}),s.medications&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground font-medium",children:"Medications:"}),e.jsx("p",{className:"mt-1","data-testid":`lead-medications-${a}`,children:s.medications})]}),s.preferredDay&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground font-medium",children:"Preferred Day:"}),e.jsx("p",{className:"mt-1","data-testid":`lead-preferred-day-${a}`,children:s.preferredDay})]}),s.paymentMethod&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground font-medium",children:"Payment:"}),e.jsx("p",{className:"mt-1","data-testid":`lead-payment-${a}`,children:s.paymentMethod==="insurance"?"Insurance":"Self-Pay"})]}),s.insuranceProvider&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground font-medium",children:"Insurance Provider:"}),e.jsx("p",{className:"mt-1","data-testid":`lead-insurance-${a}`,children:s.insuranceProvider})]}),s.insuredName&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground font-medium",children:"Insured Name:"}),e.jsx("p",{className:"mt-1",children:s.insuredName})]}),s.insuredDob&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground font-medium",children:"Insured DOB:"}),e.jsx("p",{className:"mt-1",children:s.insuredDob})]}),s.memberId&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground font-medium",children:"Member ID:"}),e.jsx("p",{className:"mt-1",children:s.memberId})]})]})]})]},s.id))})})]})]})]})}export{De as default};
