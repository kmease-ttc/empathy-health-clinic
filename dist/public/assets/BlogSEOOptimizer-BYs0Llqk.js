import{O as z,N as F,G as y,u as H,Q,j as e,B as w,W as m,C as M,c as E,d as D,F as W,e as L,f as q,D as B,a1 as I,a7 as $}from"./index-CgsemtNf.js";import{T as P}from"./textarea-BXdjjUtM.js";import{B as b}from"./badge-CYF5D6iW.js";import{T as G,a as U,b as R,c as T}from"./tabs-BonmKIaG.js";import{L as c}from"./label-BjwbQxMY.js";import{H as V}from"./house-d9x4eLL5.js";import{S as _}from"./search-CgS1i4Xf.js";import{C as O}from"./circle-alert-DGxppOlc.js";import{T as J}from"./trending-up-KAb4bHo1.js";function K(a,h){const x=a.content.toLowerCase(),C=(a.metaTitle||a.title).toLowerCase(),i=a.content.split(/\s+/).length,d=(h==null?void 0:h.toLowerCase())||"",g=d?C.includes(d):!1,u=x.match(/^#\s+(.+)$/m),t=u?u[1].toLowerCase():"",n=d?t.includes(d):!1,j=d?(x.match(new RegExp(d.replace(/\s+/g,"\\s+"),"gi"))||[]).length:0,p=d?j/i*100:0,v=x.split(/[.!?]+/).filter(o=>o.trim()).length/i*100,S=Math.max(0,Math.min(100,100-v*5)),k=!!a.metaDescription&&a.metaDescription.length>=120,f=!!a.keywords&&a.keywords.length>0,N=!!(a.averageRating&&a.ratingCount);let l=0;return i>=1800?l+=20:i>=1200?l+=15:i>=800&&(l+=10),g&&(l+=15),n&&(l+=15),p>=.5&&p<=2.5&&(l+=15),S>=60&&(l+=10),k&&(l+=10),f&&(l+=10),N&&(l+=5),{wordCount:i,titleKeywordMatch:g,h1KeywordMatch:n,bodyKeywordDensity:p,readabilityScore:S,hasMetaDescription:k,hasKeywords:f,hasRatings:N,overallScore:Math.min(100,l)}}function A({score:a}){return a>=80?e.jsxs(b,{className:"bg-green-600",children:["Excellent: ",a,"%"]}):a>=60?e.jsxs(b,{className:"bg-yellow-600",children:["Good: ",a,"%"]}):a>=40?e.jsxs(b,{className:"bg-orange-600",children:["Fair: ",a,"%"]}):e.jsxs(b,{variant:"destructive",children:["Poor: ",a,"%"]})}function ie(){const[,a]=z(),{toast:h}=F(),[x,C]=y.useState(""),[i,d]=y.useState(null),[g,u]=y.useState(""),[t,n]=y.useState({}),{data:j,isLoading:p}=H({queryKey:["/api/blog-posts"]}),v=Q({mutationFn:async s=>await I("PATCH",`/api/blog-posts/${s.id}`,s.updates),onSuccess:()=>{$.invalidateQueries({queryKey:["/api/blog-posts"]}),h({title:"Success",description:"Blog post updated successfully"}),d(null),n({}),u("")},onError:s=>{h({title:"Error",description:s.message,variant:"destructive"})}}),f=((j==null?void 0:j.posts)||[]).filter(s=>s.title.toLowerCase().includes(x.toLowerCase())||s.slug.toLowerCase().includes(x.toLowerCase())).map(s=>{var r;return{post:s,analysis:K(s,((r=s.keywords)==null?void 0:r[0])||"")}}).sort((s,r)=>s.analysis.overallScore-r.analysis.overallScore),N=s=>{d(s),n({title:s.title,metaTitle:s.metaTitle||s.title,metaDescription:s.metaDescription||s.excerpt,keywords:s.keywords||[],content:s.content,averageRating:s.averageRating||void 0,ratingCount:s.ratingCount||void 0,bestRating:s.bestRating||5,worstRating:s.worstRating||1}),u("")},l=()=>{i&&v.mutate({id:i.id,updates:t})},o=i?K({...i,...t},g):null;return p?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading blog posts..."})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border sticky top-0 bg-background/95 backdrop-blur-md z-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-sans font-medium",children:"Blog SEO Optimizer"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Optimize blog posts for search engines"})]}),e.jsxs(w,{variant:"outline",onClick:()=>a("/admin"),"data-testid":"button-back-to-admin",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Back to Admin"]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-8",children:i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:i.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["/",i.slug]})]}),e.jsx(w,{variant:"outline",onClick:()=>{d(null),n({}),u("")},"data-testid":"button-cancel-edit",children:"Cancel"})]}),o&&e.jsxs(M,{children:[e.jsx(E,{children:e.jsxs(D,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"SEO Score"}),e.jsx(A,{score:o.overallScore})]})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Word Count"}),e.jsxs("p",{className:"font-medium",children:[o.wordCount," ",o.wordCount>=1800?"✓":"❌"]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Title Keyword"}),e.jsx("p",{className:"font-medium",children:o.titleKeywordMatch?"✓":"❌"})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"H1 Keyword"}),e.jsx("p",{className:"font-medium",children:o.h1KeywordMatch?"✓":"❌"})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Keyword Density"}),e.jsxs("p",{className:"font-medium",children:[o.bodyKeywordDensity.toFixed(2),"%"]})]})]})})]}),e.jsxs(G,{defaultValue:"metadata",className:"w-full",children:[e.jsxs(U,{className:"grid w-full grid-cols-3",children:[e.jsx(R,{value:"metadata",children:"Metadata"}),e.jsx(R,{value:"content",children:"Content"}),e.jsx(R,{value:"ratings",children:"Ratings"})]}),e.jsxs(T,{value:"metadata",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Target Keyword (for analysis)"}),e.jsx(m,{placeholder:"e.g., define love bombing",value:g,onChange:s=>u(s.target.value),"data-testid":"input-target-keyword"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter the keyword you want to optimize for"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Page Title (H1)"}),e.jsx(m,{value:t.title||"",onChange:s=>n({...t,title:s.target.value}),placeholder:"Blog post title","data-testid":"input-title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Meta Title (SEO Title)"}),e.jsx(m,{value:t.metaTitle||"",onChange:s=>n({...t,metaTitle:s.target.value}),placeholder:"SEO title for search engines","data-testid":"input-meta-title"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(t.metaTitle||"").length,"/60 characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Meta Description"}),e.jsx(P,{value:t.metaDescription||"",onChange:s=>n({...t,metaDescription:s.target.value}),placeholder:"Brief description for search engines",rows:3,"data-testid":"textarea-meta-description"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(t.metaDescription||"").length,"/160 characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Keywords (comma-separated)"}),e.jsx(m,{value:(t.keywords||[]).join(", "),onChange:s=>n({...t,keywords:s.target.value.split(",").map(r=>r.trim()).filter(Boolean)}),placeholder:"keyword1, keyword2, keyword3","data-testid":"input-keywords"})]})]}),e.jsx(T,{value:"content",className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Content (Markdown)"}),e.jsx(P,{value:t.content||"",onChange:s=>n({...t,content:s.target.value}),placeholder:"Blog post content in markdown format",rows:20,className:"font-mono text-sm","data-testid":"textarea-content"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(t.content||"").split(/\s+/).length," words"]})]})}),e.jsxs(T,{value:"ratings",className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Add aggregate ratings to show star ratings in search results (SERP features)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Average Rating"}),e.jsx(m,{type:"number",step:"0.1",min:"0",max:"5",value:t.averageRating||"",onChange:s=>n({...t,averageRating:parseFloat(s.target.value)||void 0}),placeholder:"4.8","data-testid":"input-average-rating"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Number of Ratings"}),e.jsx(m,{type:"number",min:"0",value:t.ratingCount||"",onChange:s=>n({...t,ratingCount:parseInt(s.target.value)||void 0}),placeholder:"245","data-testid":"input-rating-count"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Best Rating"}),e.jsx(m,{type:"number",min:"1",value:t.bestRating||5,onChange:s=>n({...t,bestRating:parseInt(s.target.value)||5}),placeholder:"5","data-testid":"input-best-rating"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Worst Rating"}),e.jsx(m,{type:"number",min:"1",value:t.worstRating||1,onChange:s=>n({...t,worstRating:parseInt(s.target.value)||1}),placeholder:"1","data-testid":"input-worst-rating"})]})]}),t.averageRating&&t.ratingCount&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Preview:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[[...Array(5)].map((s,r)=>e.jsx(B,{className:`h-5 w-5 ${r<Math.round(t.averageRating||0)?"fill-yellow-500 text-yellow-500":"text-muted-foreground"}`},r)),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.averageRating,"/5 (",t.ratingCount," ratings)"]})]})]})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(w,{onClick:l,disabled:v.isPending,className:"flex-1","data-testid":"button-save-changes",children:v.isPending?"Saving...":"Save Changes"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search blog posts...",value:x,onChange:s=>C(s.target.value),className:"pl-10","data-testid":"input-search-posts"})]})}),e.jsx("div",{className:"grid gap-4",children:f.map(({post:s,analysis:r})=>e.jsxs(M,{className:"hover-elevate",children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(D,{className:"text-lg",children:s.title}),e.jsxs(W,{className:"mt-1",children:["/",s.slug]})]}),e.jsx(A,{score:r.overallScore})]})}),e.jsxs(L,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Word Count"}),e.jsx("p",{className:"font-medium",children:r.wordCount})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Readability"}),e.jsxs("p",{className:"font-medium",children:[Math.round(r.readabilityScore),"%"]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Meta Desc"}),e.jsx("p",{className:"font-medium",children:r.hasMetaDescription?e.jsx(q,{className:"h-4 w-4 text-green-600 inline"}):e.jsx(O,{className:"h-4 w-4 text-orange-600 inline"})})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Ratings"}),e.jsx("p",{className:"font-medium",children:r.hasRatings?e.jsx(B,{className:"h-4 w-4 text-yellow-600 inline"}):e.jsx(O,{className:"h-4 w-4 text-muted-foreground inline"})})]})]}),e.jsxs(w,{onClick:()=>N(s),className:"w-full","data-testid":`button-edit-${s.slug}`,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Optimize SEO"]})]})]},s.id))})]})})]})}export{ie as default};
