import{N as R,u as j,Q as p,j as e,C as t,c as n,d as c,F as m,e as o,q as x,B as v,a1 as g,a7 as N}from"./index-CgsemtNf.js";import{B as b}from"./badge-CYF5D6iW.js";import{C as y}from"./circle-alert-DGxppOlc.js";import{R as F}from"./refresh-cw-BXMHVCn8.js";function q(){const{toast:a}=R(),{data:r=[],isLoading:f}=j({queryKey:["/api/email-failures",{resolved:!1}]}),{data:i=[],isLoading:C}=j({queryKey:["/api/email-failures",{resolved:!0}]}),d=p({mutationFn:async s=>g("POST",`/api/email-failures/${s}/retry`),onSuccess:()=>{N.invalidateQueries({queryKey:["/api/email-failures"]}),a({title:"Email Retry Successful",description:"The email has been resent successfully."})},onError:s=>{a({title:"Retry Failed",description:s.message,variant:"destructive"})}}),u=p({mutationFn:async s=>g("POST",`/api/email-failures/${s}/resolve`),onSuccess:()=>{N.invalidateQueries({queryKey:["/api/email-failures"]}),a({title:"Email Failure Resolved",description:"The failure has been marked as resolved."})},onError:s=>{a({title:"Resolve Failed",description:s.message,variant:"destructive"})}}),l=s=>new Date(s).toLocaleString(),h=s=>e.jsxs(t,{className:"mb-4",children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(c,{className:"text-lg flex items-center gap-2",children:[s.resolved?e.jsx(x,{className:"h-5 w-5 text-green-600"}):e.jsx(y,{className:"h-5 w-5 text-red-600"}),s.emailType.replace(/_/g," ").toUpperCase()]}),e.jsxs(m,{className:"mt-1",children:["Recipient: ",s.recipientEmail]})]}),e.jsx(b,{variant:s.resolved?"secondary":"destructive",children:s.resolved?"Resolved":"Unresolved"})]})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Error Message:"}),e.jsx("p",{className:"text-sm mt-1 font-mono bg-muted p-2 rounded",children:s.errorMessage})]}),s.leadId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Lead ID:"}),e.jsx("p",{className:"text-sm mt-1",children:s.leadId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created:"}),e.jsx("p",{className:"text-sm mt-1",children:l(s.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Retry Count:"}),e.jsx("p",{className:"text-sm mt-1",children:s.retryCount})]})]}),s.lastRetryAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Retry:"}),e.jsx("p",{className:"text-sm mt-1",children:l(s.lastRetryAt)})]}),s.resolvedAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Resolved:"}),e.jsx("p",{className:"text-sm mt-1",children:l(s.resolvedAt)})]}),!s.resolved&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(v,{size:"sm",onClick:()=>d.mutate(s.id),disabled:d.isPending,"data-testid":`button-retry-${s.id}`,children:[e.jsx(F,{className:`h-4 w-4 mr-2 ${d.isPending?"animate-spin":""}`}),"Retry Email"]}),e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>u.mutate(s.id),disabled:u.isPending,"data-testid":`button-resolve-${s.id}`,children:[e.jsx(x,{className:"h-4 w-4 mr-2"}),"Mark Resolved"]})]})]})})]},s.id);return e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Email Failure Monitor"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Track and retry failed email notifications"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(t,{className:"mb-4 bg-red-50 dark:bg-red-950",children:e.jsxs(n,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-red-600"}),"Unresolved Failures (",r.length,")"]}),e.jsx(m,{children:"Email failures that need attention"})]})}),f?e.jsx("p",{children:"Loading..."}):r.length===0?e.jsx(t,{children:e.jsx(o,{className:"py-8 text-center text-muted-foreground",children:"No unresolved email failures"})}):r.map(h)]}),e.jsxs("div",{children:[e.jsx(t,{className:"mb-4 bg-green-50 dark:bg-green-950",children:e.jsxs(n,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5 text-green-600"}),"Resolved Failures (",i.length,")"]}),e.jsx(m,{children:"Successfully resolved email failures"})]})}),C?e.jsx("p",{children:"Loading..."}):i.length===0?e.jsx(t,{children:e.jsx(o,{className:"py-8 text-center text-muted-foreground",children:"No resolved failures yet"})}):i.map(h)]})]})]})}export{q as default};
